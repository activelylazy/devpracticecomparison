<html>
	<head>
		<script src="js/jquery.min.js" type="text/javascript"></script>
		<script src="js/jquery.flot.js" type="text/javascript"></script>
	</head>
	<body>
		<h1>Graph</h1>
		
		<div id="placeholder" style="width:600px;height:400px"></div>
		
		<script>
			function refreshScores() {
				$.getJSON("/scores.json", updateScores);
			}
			function updateScores(results) {
				if (!results) {
					alert("No results!");
					return;
				}

				$("h1").empty();
				$("h1").append("Updated "+new Date());
				$.plot($("#placeholder"),
						[
							{
								data: [[1, getScoreForGroup(results, "TDD")], 
								       [3, getScoreForGroup(results, "NoTDD")]],
								bars: {show: true}
							}
						],
						{
							xaxis: {
								ticks: [ [0, ""], [1.5, "TDD"], [3.5, "No TDD"]],
								min: 0,
								max: 5
							}
						}
					);
				
				window.setTimeout("refreshScores()", 1);
			}
			
			function getScoreForGroup(results, groupName) {
				var score = 0;
				for (i=0; i<results.clients.length; i++) {
					if (results.clients[i].group === groupName) {
						score += results.clients[i].score;
					}
				}
				return score;
			}

			refreshScores();
		</script>
	</body>
</html>